<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Handsome-FormValidate</title>
	<!-- CSS -->
	<link rel="stylesheet" type="text/css" href="http://cdn.amazeui.org/amazeui/2.4.0/css/amazeui.min.css">


	<!-- JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="http://cdn.bootcss.com/angular.js/1.4.0-rc.1/angular.js"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular.min.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.10/angular-sanitize.min.js"></script>
	<script src="http://cdn.amazeui.org/amazeui/2.4.0/js/amazeui.min.js"></script>

	<!-- Your's CSS -->
	<style type="text/css">
		.password-strength{
			height: 6px;
			background-color: #F8F8F8;
			margin-bottom: 6px;
		}
    .password-strength .p-s-s{
      position: relative;
      width: 0%;
      height: 100%;
      background-color: #F00;
    }
    .confirm-password{
      border: 1px solid red !important;
    }
    .confirm-info{
      color: red;
    }
	</style>
	
</head>
<body ng-app="MyApp">
	<form name="form" class="am-form hsfvForm" hsfv ng-controller="HsfvController">
  	<fieldset>
  	    <legend>Handsome Form Validate</legend>
  	
  	    <div class="am-form-group">
  	      <label for="hsfv-username"><span class="am-icon-user"></span>&nbsp;用户名：</label>
  	      <input name="hsfvUsername" type="text" class="" id="hsfv-username" placeholder="请输入用户名">
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="hsfv-password"><span class="am-icon-key"></span>&nbsp;密码：<span ng-show="form.hsfvPassword.$dirty" class="password-strength-flag">弱</span></label>
  	      <div class="password-strength am-g" ng-show="form.hsfvPassword.$dirty">
           <div class="p-s-s"></div> 
          </div>
  	      <input name="hsfvPassword" password-strength ng-model="user.password" type="password" class="password" id="hsfv-password" placeholder="请设置一个密码">
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="hsfv-password-repeat"><span class="am-icon-repeat"></span>&nbsp;重复密码：<span ng-show="form.hsfvPasswordRepeat.$invalid && form.hsfvPasswordRepeat.$dirty" class="confirm-info">确认密码错误</span></label>
  	      <input name="hsfvPasswordRepeat" hsfv-repeat-password="hsfvPassword" ng-model="user.repeatPassword" type="password" class="" id="hsfv-password-repeat" placeholder="请重复上述密码">
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="hsfv-email"><span class="am-icon-envelope"></span>&nbsp;邮箱：</label>
  	      <input name="hsfvEmail" type="email" class="" id="hsfv-email" placeholder="请填写你的邮箱">
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="hsfv-phone"><span class="am-icon-mobile-phone am-icon-sm"></span>&nbsp;手机：</label>
  	      <input name="hsfvPhone" type="email" class="" id="hsfv-phone" placeholder="请填写你的手机号码">
  	    </div>
  	
  	    <div class="am-form-group am-form-file">
  	      <label for="doc-ipt-file-2">Amaze UI 文件上传域</label>
  	      <div>
  	        <button type="button" class="am-btn am-btn-default am-btn-sm">
  	          <i class="am-icon-cloud-upload"></i> 选择要上传的文件</button>
  	      </div>
  	      <input type="file" id="doc-ipt-file-2">
  	    </div>
  	
  	    <div class="am-checkbox">
  	      <label>
  	        <input type="checkbox"> 复选框，选我选我选我
  	      </label>
  	    </div>
  	
  	    <div class="am-radio">
  	      <label>
  	        <input type="radio" name="doc-radio-1" value="option1" checked>
  	        单选框 - 选项1
  	      </label>
  	    </div>
  	
  	    <div class="am-radio">
  	      <label>
  	        <input type="radio" name="doc-radio-1" value="option2">
  	        单选框 - 选项2
  	      </label>
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label class="am-checkbox-inline">
  	        <input type="checkbox" value="option1"> 选我
  	      </label>
  	      <label class="am-checkbox-inline">
  	        <input type="checkbox" value="option2"> 同时可以选我
  	      </label>
  	      <label class="am-checkbox-inline">
  	        <input type="checkbox" value="option3"> 还可以选我
  	      </label>
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label class="am-radio-inline">
  	        <input type="radio"  value="" name="docInlineRadio"> 每一分
  	      </label>
  	      <label class="am-radio-inline">
  	        <input type="radio" name="docInlineRadio"> 每一秒
  	      </label>
  	      <label class="am-radio-inline">
  	        <input type="radio" name="docInlineRadio"> 多好
  	      </label>
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="doc-select-1">下拉多选框</label>
  	      <select id="doc-select-1">
  	        <option value="option1">选项一...</option>
  	        <option value="option2">选项二.....</option>
  	        <option value="option3">选项三........</option>
  	      </select>
  	      <span class="am-form-caret"></span>
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="doc-select-2">多选框</label>
  	      <select multiple class="" id="doc-select-2">
  	        <option>1</option>
  	        <option>2</option>
  	        <option>3</option>
  	        <option>4</option>
  	        <option>5</option>
  	      </select>
  	    </div>
  	
  	    <div class="am-form-group">
  	      <label for="doc-ta-1">文本域</label>
  	      <textarea class="" rows="5" id="doc-ta-1"></textarea>
  	    </div>
  	
  	    <p><button type="submit" class="am-btn am-btn-default">提交</button></p>
  	  </fieldset>
</form>




	
	<script type="text/javascript">
		// "use strict";
		angular.module("MyApp", ["ngSanitize"])
		.controller("HsfvController", function($scope){
			// 
		})
		.directive("hsfv", ["$sce", function($sce){
			return {
				restrict: "AE",
				require: "?ngModel",
				link: function (scope, iElement, iAttrs, ngModelCtrl){
					if(!ngModelCtrl) return;
					// console.log(iElement.children(".p-s-s"));

				}
			};
		}])
		.directive("passwordStrength", function(){
			return {
				restrict: "AE",
				require: "ngModel",
				link: function (scope, iElement, iAttrs, ngModelCtrl){
					if(!ngModelCtrl) return;

            var passwordShow = iElement.parent().children(".password-strength").children(".p-s-s");
            var passwordContainer = iElement.parent().children(".password-strength");
            var totalLength = parseInt(passwordContainer.css("width"));
            var per = totalLength / 12;
            var color = ["#FF0000", "#4DFFFF", "#0080FF"];

					scope.$watch("user.password", function(newValue){
            var password = newValue + "";
            var length = password.length;
            switch (length){
              case 0: {angular.element(".password-strength-flag").text("弱");
                      angular.element(".password-strength-flag").css({"color": "red"});
                      break;}
              case 6: {angular.element(".password-strength-flag").text("中");
                      angular.element(".password-strength-flag").css({"color": "blue"});
                      break;}
              case 12: {angular.element(".password-strength-flag").text("强");
                      angular.element(".password-strength-flag").css({"color": "#00DB00"});
                      break;}
            }
            var showLength = (length * per < totalLength) ? (length * per) : totalLength;
            passwordShow.css({"width": showLength + "px" });
            passwordShow.css({"background-color": color[length/3]});
            
					});				
				}
			};
		})
		.directive("hsfvRepeatPassword", function(){
			return {
				restrict: 'AE',
				require: "ngModel",
				link: function (scope, iElement, iAttrs, ngModelCtrl) {
					if(!ngModelCtrl) return;
          var passwordModel = iElement.inheritedData("$formController")[iAttrs.hsfvRepeatPassword];

          var passwordConfirm = function(viewValue){
            var compareBorder = (viewValue+"").length - (passwordModel.$viewValue+"").length;
            if(compareBorder < 0){
              ngModelCtrl.$setValidity("hsfvRepeatPassword", true);
              return viewValue ? viewValue : undefined;
            }
            var validity = (viewValue === passwordModel.$viewValue);
            ngModelCtrl.$setValidity("hsfvRepeatPassword", validity);

            if(ngModelCtrl.$invalid){
              iElement.addClass("confirm-password");
            }
            else{
              iElement.removeClass("confirm-password");
            }
            return viewValue ? viewValue : undefined;
            }

          ngModelCtrl.$formatters.push(passwordConfirm);
          ngModelCtrl.$parsers.push(passwordConfirm);

          passwordModel.$parsers.push(function(viewValue){
            if(ngModelCtrl.$invalid){
              iElement.addClass("confirm-password");
            }
            else{
              iElement.removeClass("confirm-password");
            }
            var validity = (viewValue === ngModelCtrl.$viewValue);
            var compareBorder = (viewValue+"").length - (ngModelCtrl.$viewValue+"").length;
            if(compareBorder < 0){
              ngModelCtrl.$setValidity("hsfvRepeatPassword", true);
              return viewValue ? viewValue : undefined;
            }
            ngModelCtrl.$setValidity("hsfvRepeatPassword", validity);
            return viewValue;
          });
				}
			};
		})
	</script>
</body>
</html>